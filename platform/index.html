<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Lab Cyber ‚Äì Plateforme d'apprentissage</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1 class="logo">Lab Cyber</h1>
        <p class="tagline">Sc√©narios guid√©s ¬∑ Style TryHackMe / HackTheBox</p>
      </div>
      <nav class="nav">
        <button class="nav-item active" data-view="dashboard">
          <span class="nav-icon">‚óÜ</span>
          <span>Accueil</span>
        </button>
        <a class="nav-item" id="nav-terminal" href="#" target="_blank" rel="noopener" title="Ouvrir le terminal du lab (poste attaquant)">
          <span class="nav-icon">‚å®</span>
          <span>Terminal lab</span>
        </a>
        <button class="nav-item" data-view="docs" type="button" title="Documentation du projet">
          <span class="nav-icon">üìö</span>
          <span>Doc. projet</span>
        </button>
        <button class="nav-item" data-view="learning" type="button" title="Documentation et cours par th√®me (crypto, phishing, outils‚Ä¶)">
          <span class="nav-icon">üìñ</span>
          <span>Doc &amp; Cours</span>
        </button>
        <button class="nav-item" data-view="engagements" type="button" title="Engagements r√©els : cibles, proxy, notes">
          <span class="nav-icon">üéØ</span>
          <span>Engagements</span>
        </button>
        <div class="nav-section">Sc√©narios guid√©s</div>
        <div id="nav-scenarios"></div>
        <div class="nav-section">Rooms par cat√©gorie</div>
        <div id="nav-rooms"></div>
      </nav>
      <div class="sidebar-footer">
        <span>Usage √©ducatif uniquement</span>
      </div>
    </aside>
    <main class="main">
      <!-- Barre du haut : recherche, filtre, stats, options -->
      <header class="topbar">
        <div class="topbar-brand">
          <button type="button" class="topbar-btn sidebar-toggle" id="btn-sidebar-toggle" aria-label="Ouvrir le menu" title="Menu">‚ò∞</button>
          <span class="topbar-brand-text" id="topbar-brand-text">Lab Cyber</span>
        </div>
        <div class="topbar-left">
          <input type="search" id="search-input" class="search-input" placeholder="Rechercher sc√©narios, rooms, docs‚Ä¶" aria-label="Recherche">
          <select id="filter-category" class="filter-category" aria-label="Cat√©gorie">
            <option value="">Toutes les cat√©gories</option>
          </select>
        </div>
        <div class="topbar-right">
          <button type="button" class="topbar-btn" id="btn-terminal-toggle" title="Afficher / masquer le terminal (ou ouvrir dans un onglet)">‚å® Terminal</button>
          <button type="button" class="topbar-btn" id="btn-stats" title="Statistiques et avancement">üìä Stats</button>
          <button type="button" class="topbar-btn" id="btn-options" title="Options">‚öôÔ∏è Options</button>
          <button type="button" class="topbar-btn" id="btn-log-toggle" title="Ouvrir / fermer le journal d'activit√©">üìã Journal</button>
          <button type="button" class="topbar-btn" id="btn-pip-toggle" title="Garder le sc√©nario visible (mini)">üìå PiP sc√©nario</button>
        </div>
      </header>
      <div id="topbar-context" class="topbar-context" aria-live="polite"></div>
      <!-- Panneau PiP : sc√©nario en miniature (type vid√©o r√©duite) -->
      <div id="pip-panel" class="pip-panel hidden" aria-label="Sc√©nario en cours">
        <div class="pip-header">
          <span id="pip-title" class="pip-title">Sc√©nario</span>
          <button type="button" id="pip-close" class="pip-close" title="Fermer">√ó</button>
        </div>
        <div class="pip-body">
          <ul id="pip-tasks"></ul>
        </div>
      </div>
      <!-- Dashboard -->
      <div id="view-dashboard" class="view active">
        <header class="page-header">
          <h2>Bienvenue sur le Lab Cyber</h2>
          <p>Suis des <strong>sc√©narios guid√©s</strong> pas √† pas (comme sur TryHackMe / HackTheBox) : objectifs concrets, commandes √† lancer, ce que tu apprends √† chaque √©tape. Tu peux aussi explorer les <strong>rooms</strong> par cat√©gorie. <strong>Un seul port</strong> pour tout le lab (gateway).</p>
        </header>
        <section class="dashboard-section" id="dashboard-mypost">
          <h3 class="section-title">Mon poste (lab)</h3>
          <p class="section-desc">Terminal web = conteneur attaquant. En ligne de commande : <code>make shell</code> ou <code>docker compose exec attaquant bash</code>.</p>
          <div class="dashboard-grid" id="dashboard-terminal-cards"></div>
        </section>
        <section class="dashboard-section">
          <h3 class="section-title">Sc√©narios guid√©s</h3>
          <p class="section-desc">Parcours pas √† pas avec t√¢ches, commandes et apprentissages concrets.</p>
          <div class="dashboard-grid" id="dashboard-scenarios"></div>
        </section>
        <section class="dashboard-section">
          <h3 class="section-title">Rooms</h3>
          <p class="section-desc">Par th√®me : Web, R√©seau, API, Red/Blue Team, St√©gano, Crypto, Phishing‚Ä¶</p>
          <div class="dashboard-grid" id="dashboard-cards"></div>
        </section>
        <section class="dashboard-section">
          <h3 class="section-title">Documentation et tests</h3>
          <p class="section-desc">Toute la doc du projet (d√©marrage, usage, tests, cat√©gories). Voir aussi le <strong>Terminal lab</strong> pour ex√©cuter les attaques depuis le navigateur.</p>
          <div class="dashboard-grid" id="dashboard-docs-cards"></div>
        </section>
      </div>
      <!-- Vue Engagements : cibles, proxy, notes (tests r√©els) -->
      <div id="view-engagements" class="view">
        <header class="page-header">
          <h2>Engagements r√©els</h2>
          <p>D√©finis des <strong>cibles</strong> (ou groupes), configure un <strong>proxy</strong> pour prot√©ger ton identit√©, et garde tes <strong>notes et r√©sultats</strong>. Utilise le terminal du lab (ou ton VPS) pour lancer tes tests. Donn√©es enregistr√©es localement.</p>
        </header>
        <section class="dashboard-section">
          <h3 class="section-title">Proxy / Anonymat</h3>
          <p class="section-desc">√Ä configurer dans ton environnement (terminal) avant les tests : HTTP_PROXY, HTTPS_PROXY, ou VPN.</p>
          <div class="engagement-block">
            <label>Notes proxy (pour toi)</label>
            <textarea id="engagement-proxy-notes" class="engagement-notes" rows="3" placeholder="Ex: export HTTP_PROXY=http://proxy:8080&#10;Ou : connexion VPN X avant de lancer les scans..."></textarea>
          </div>
        </section>
        <section class="dashboard-section">
          <h3 class="section-title">Cibles</h3>
          <p class="section-desc">Ajoute des cibles (URL, IP, nom) pour ton engagement. Clique sur une cible pour la modifier ou la supprimer.</p>
          <form id="engagement-target-form" class="engagement-form">
            <input type="text" id="engagement-target-name" placeholder="Nom (ex: API prod)" required>
            <input type="text" id="engagement-target-url" placeholder="URL ou IP (ex: https://api.example.com)">
            <input type="text" id="engagement-target-notes" placeholder="Notes (scope, credentials de test...)">
            <button type="submit" class="topbar-btn">Ajouter la cible</button>
          </form>
          <ul id="engagement-targets-list" class="engagement-list"></ul>
        </section>
        <section class="dashboard-section">
          <h3 class="section-title">Notes et r√©sultats</h3>
          <p class="section-desc">R√©dige tes observations, commandes utiles, preuves (√† copier-coller depuis le terminal).</p>
          <textarea id="engagement-notes" class="engagement-notes" rows="12" placeholder="R√©sultats des scans, vuln√©rabilit√©s trouv√©es, commandes √† rejouer..."></textarea>
        </section>
      </div>
      <!-- Documentation (liste des docs + viewer int√©gr√©) -->
      <div id="view-docs" class="view view-docs">
        <header class="page-header docs-header">
          <h2 id="docs-title">Documentation du projet</h2>
          <p id="docs-description" class="room-description">Chargement‚Ä¶</p>
        </header>
        <div class="docs-layout">
          <nav class="docs-nav">
            <h3>Fichiers</h3>
            <ul id="docs-list" class="docs-list"></ul>
          </nav>
          <div id="docs-viewer" class="docs-viewer">
            <div id="docs-viewer-placeholder" class="docs-viewer-placeholder">Choisissez un document dans la liste.</div>
            <div id="docs-viewer-content" class="docs-viewer-content hidden"></div>
          </div>
        </div>
        <section class="room-section docs-footer">
          <h3>Tests du syst√®me</h3>
          <p>Pour lancer tous les tests depuis le terminal : <code>./lab test</code> ou <code>make test</code>. Voir la doc <button type="button" class="link-button" data-doc-file="TESTS.md">TESTS.md</button> pour la matrice compl√®te.</p>
          <p><a href="/test-logs.html" target="_blank" rel="noopener">Page de test du logger</a> (journal d'activit√©).</p>
        </section>
      </div>
      <!-- Documentation & Cours par th√®me -->
      <div id="view-learning" class="view">
        <header class="page-header">
          <h2 id="learning-title">Documentation &amp; Cours</h2>
          <p id="learning-description" class="room-description">Par sujet : documentation officielle, cours complets, et outils d√©taill√©s (crypto, phishing, web, forensique, etc.).</p>
        </header>
        <section class="room-section">
          <p class="section-desc">Choisis un th√®me pour acc√©der √† la <strong>documentation</strong>, aux <strong>cours</strong> et aux <strong>outils</strong>.</p>
          <div id="learning-topics" class="learning-topics"></div>
        </section>
      </div>
      <!-- Scenario view (THM/HTB style) : sc√©nario + terminal int√©gr√© -->
      <div id="view-scenario" class="view view-scenario-with-terminal">
        <div class="scenario-content-column">
          <header class="page-header scenario-header">
            <div class="room-meta">
              <span id="scenario-difficulty" class="difficulty-badge"></span>
              <span id="scenario-time" class="time-badge"></span>
            </div>
            <h2 id="scenario-title"></h2>
            <p id="scenario-description" class="room-description"></p>
            <div id="scenario-resume-banner" class="scenario-resume-banner hidden" role="status"></div>
          </header>
          <section class="room-section machines-section">
            <h3>D√©ployer / Acc√©der aux cibles</h3>
            <div id="scenario-machines" class="machine-cards"></div>
          </section>
          <section class="room-section">
            <h3>T√¢ches</h3>
            <div id="scenario-tasks" class="tasks-list scenario-tasks"></div>
          </section>
        </div>
        <aside class="scenario-terminal-panel" id="scenario-terminal-panel">
          <div class="terminal-panel-header">
            <h3>‚å® Terminal attaquant</h3>
            <div class="terminal-panel-actions">
              <button type="button" id="terminal-open-new-tab" class="topbar-btn" title="Ouvrir dans un nouvel onglet">Nouvel onglet</button>
              <button type="button" id="terminal-toggle-panel" class="topbar-btn" title="R√©duire / agrandir">‚àí</button>
            </div>
          </div>
          <div id="terminal-connect-status" class="terminal-status" aria-live="polite"></div>
          <div id="terminal-container" class="terminal-container"></div>
        </aside>
      </div>
      <!-- Room view (existing) -->
      <div id="view-room" class="view">
        <header class="page-header room-header">
          <div class="room-meta">
            <span id="room-category-badge" class="badge"></span>
            <span id="room-difficulty" class="difficulty"></span>
          </div>
          <h2 id="room-title"></h2>
          <p id="room-description" class="room-description"></p>
        </header>
        <section id="room-reading-section" class="room-section room-reading" hidden>
          <h3>üìñ Lecture recommand√©e</h3>
          <p class="section-desc">Documentation sur ce th√®me pour aller plus loin.</p>
          <div id="room-reading-links"></div>
        </section>
        <section class="room-section">
          <h3>Objectifs</h3>
          <ul id="room-objectives"></ul>
        </section>
        <section id="room-challenges-section" class="room-section challenges-section" hidden>
          <h3>T√©l√©charger les d√©fis</h3>
          <p class="hint">T√©l√©charge les fichiers puis travaille depuis le conteneur attaquant.</p>
          <div id="room-challenge-downloads" class="machine-cards"></div>
        </section>
        <section class="room-section machines-section">
          <h3>Acc√©der aux machines</h3>
          <div id="room-machines" class="machine-cards"></div>
        </section>
        <section class="room-section">
          <h3>T√¢ches</h3>
          <div id="room-tasks" class="tasks-list"></div>
        </section>
      </div>
    </main>
    <!-- Modal Statistiques -->
    <div id="modal-stats" class="modal hidden" role="dialog" aria-labelledby="stats-title">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="stats-title">Statistiques et avancement</h2>
          <button type="button" class="modal-close" id="modal-stats-close" aria-label="Fermer">√ó</button>
        </div>
        <div class="modal-body">
          <div id="stats-summary" class="stats-summary"></div>
          <h3>Avancement par sc√©nario</h3>
          <div id="stats-scenarios" class="stats-scenarios"></div>
          <p class="stats-hint">La progression est enregistr√©e localement (navigateur).</p>
        </div>
      </div>
    </div>
    <!-- Modal Options -->
    <div id="modal-options" class="modal hidden" role="dialog" aria-labelledby="options-title">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="options-title">Options</h2>
          <button type="button" class="modal-close" id="modal-options-close" aria-label="Fermer">√ó</button>
        </div>
        <div class="modal-body">
          <div class="option-row">
            <label><input type="checkbox" id="opt-pip-auto" /> Ouvrir le PiP sc√©nario quand je lance un sc√©nario</label>
          </div>
          <div class="option-row">
            <button type="button" id="opt-export-progress" class="topbar-btn">Exporter ma progression (JSON)</button>
          </div>
          <div class="option-row">
            <button type="button" id="opt-reset-progress" class="topbar-btn danger">R√©initialiser toute la progression</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Journal d'activit√© / Logs (ferm√© par d√©faut) -->
    <aside class="log-panel collapsed" id="log-panel">
      <div class="log-panel-header">
        <h3>Journal d'activit√©</h3>
        <div class="log-panel-actions">
          <button type="button" id="log-export-json" title="Exporter en JSON">Export JSON</button>
          <button type="button" id="log-export-txt" title="Exporter en texte">Export TXT</button>
          <button type="button" id="log-clear" title="Effacer les logs">Effacer</button>
          <button type="button" id="log-panel-toggle" title="R√©duire / agrandir" aria-label="Journal">‚àí</button>
        </div>
      </div>
      <div class="log-panel-body">
        <ul id="log-entries"></ul>
      </div>
    </aside>
    <!-- Bouton flottant Journal (mobile uniquement) -->
    <button type="button" class="log-fab" id="log-fab" aria-label="Ouvrir le journal" title="Journal d'activit√©">üìã</button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="js/logger.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
